"""
全局配置文件
修改配置只需编辑此文件
"""
import os

# ============================================================
# 数据库配置
# ============================================================
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
DB_PATH = os.path.join(BASE_DIR, "user_memory.db")
CHAT_HISTORY_DB = os.path.join(BASE_DIR, "src", "chat_history.db")

# ============================================================
# 用户档案配置（Markdown存储）
# ============================================================
# 用户健康档案的Markdown文件存储目录
USER_PROFILES_DIR = os.path.join(BASE_DIR, "user_profiles")
# 是否启用Markdown同步（设为False可禁用）
ENABLE_MARKDOWN_SYNC = True

# ============================================================
# HITL (Human-in-the-Loop) 配置
# ============================================================
# 是否启用HITL审核机制
ENABLE_HITL = True
# HITL审核文件目录
HITL_BASE_DIR = os.path.join(BASE_DIR, "hitl_reviews")

# ============================================================
# 结构化问诊配置
# ============================================================
# 用户数据目录（JSON档案）
USER_DATA_DIR = os.path.join(BASE_DIR, "user_data")

# ============================================================
# 记忆配置
# ============================================================
# 短期记忆：超过此消息数触发摘要
MAX_MESSAGES_BEFORE_SUMMARY = 16
# 摘要后保留的最近消息数
KEEP_RECENT_MESSAGES = 6

# ============================================================
# 健康信息提取配置
# ============================================================
# 需要提取的健康信息类别
HEALTH_CATEGORIES = {
    "身体指标": {
        "keywords": ["身高", "体重", "年龄", "性别", "血压", "血糖", "心率"],
        "important": False,
        "description": "基本身体数据"
    },
    "过敏信息": {
        "keywords": ["过敏", "不能吃", "不能用"],
        "important": True,  # 过敏信息标记为重要
        "description": "药物/食物过敏史"
    },
    "疾病史": {
        "keywords": ["糖尿病", "高血压", "心脏病", "哮喘", "癌症"],
        "important": True,  # 疾病史标记为重要
        "description": "慢性病/既往病史"
    },
    "生活习惯": {
        "keywords": ["吸烟", "喝酒", "运动", "睡眠"],
        "important": False,
        "description": "日常生活习惯"
    },
    "用药情况": {
        "keywords": ["服用", "吃药", "用药"],
        "important": True,
        "description": "正在使用的药物"
    }
}

# ============================================================
# 检索配置
# ============================================================
# 向量检索返回的文档数量
RETRIEVAL_K = 4
# 最大重试次数（Self-RAG循环）
MAX_RETRIEVAL_LOOPS = 3

# ============================================================
# 模式检测关键词
# ============================================================
ASSESSMENT_KEYWORDS = [
    "计算", "评估", "BMI", "血压", "体重", "身高", 
    "热量", "心率", "kg", "cm", "多少"
]

SCIENCE_KEYWORDS = [
    "预防", "什么是", "为什么", "怎么", "如何", 
    "有什么", "原因", "作用", "好处", "症状"
]
